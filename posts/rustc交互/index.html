<!doctype html><html lang=en-us x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Rust c交互 | Caisong's Blog</title>
<link rel=canonical href=https://caisong.github.io/posts/rustc%E4%BA%A4%E4%BA%92/><meta name=author content="Cai Song"><meta name=description content='rust 调用 c 调用普通c函数 int add(int a, int b) { return a + b; } // main.rs //指定链接到C 库 #[link(name = "add")] extern { fn add(a: i32, b: i32) -> i32; } fn main() { let result = unsafe { add(1, 2) }; println!("1 + 2 = {}", result); } # 编译C库 $ gcc -c -fPIC add.c -o add.o $ gcc add.o -shared -o libadd.so # rust 链接 $ rustc main.rs -L /path/to/library/folder -l add $ ./main 1 + 2 = 3 调用C结构体 #include <stdio.h> typedef struct { int x; int y; } Point; void print_point(Point* p) { printf("Point: (%d, %d)\n", p->x, p->y); } // main.rs #[repr(C)] struct Point { x: i32, y: i32, } #[link(name = "mylib")] extern { fn print_point(p: *const Point); } fn main() { let p = Point { x: 10, y: 20 }; // 转换 Point 结构体为 C 的结构体指针类型 let c_p = &amp;p as *const Point; // 调用 C 函数 unsafe { print_point(c_p); } } 调用C内存分配 // main.rs use libc::{malloc, free}; use std::ffi::CString; #[link(name = "mylib")] extern { fn process_string(s: *const u8); } fn main() { let s = CString::new("Hello, world!").unwrap(); // 计算字符串的长度（包括终止符） let len = s.as_bytes().len() + 1; // 在 C 中分配足够的空间来保存字符串 let c_str = unsafe { malloc(len) as *mut u8 }; // 把 Rust 字符串复制到 C 字符串中 unsafe { std::ptr::copy_nonoverlapping(s.as_ptr(), c_str, len); } // 调用 C 函数并传递指向 C 字符串的指针 unsafe { process_string(c_str); } // 释放由 C 分配的内存 unsafe { free(c_str as *mut libc::c_void); } } 调用C自定义内存分配函数 // main.rs use std::os::raw::c_void; use std::alloc::{Layout, alloc, dealloc}; extern "C" { fn my_malloc(size: usize) -> *mut c_void; fn my_free(ptr: *mut c_void); } fn main() { let size = 1024; // 在 Rust 中分配内存 let layout = Layout::from_size_align(size, 1).unwrap(); let ptr = unsafe { my_malloc(size) as *mut u8 }; // 使用 Rust 操作分配的内存 for i in 0..size { unsafe { *ptr.offset(i as isize) = i as u8; } } // 调用自定义的 C 函数释放内存 unsafe { my_free(ptr as *mut c_void); } } C调用rust rust代码 #[no_mangle] pub extern "C" fn add_numbers(a:i32, b:i32) -> i32 { a + b } C 使用动态库方式调用rust rustc --crate-type=cdylib my_lib.rs #include <stdio.h> #include <stdint.h> #include <stdlib.h> #include <dlfcn.h> typedef void (*add_fn)(int32_t, int32_t, int32_t*); int main() { void* handle = dlopen("./libmylib.so", RTLD_LAZY | RTLD_GLOBAL); if (!handle) { printf("Failed to open library: %s\n", dlerror()); return -1; } add_fn add = (add_fn)dlsym(handle, "add"); if (!add) { printf("Failed to find symbol: %s\n", dlerror()); dlclose(handle); return -1; } int32_t a = 1; int32_t b = 2; int32_t result; int32_t *result_ptr = &amp;result; add(a, b, result_ptr); printf("%d + %d = %d\n", a, b, result); dlclose(handle); return 0; } C 使用静态库方式调用rust rustc --crate-type=staticlib my_lib.rs #include <stdio.h> #include <stdint.h> extern int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; } C 直接调用rust代码 #include <stdio.h> #include <stdint.h> int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; } '><meta name=keywords content="Rust,C"><meta name=generator content="Hugo 0.140.2"><meta property="og:url" content="https://caisong.github.io/posts/rustc%E4%BA%A4%E4%BA%92/"><meta property="og:site_name" content="Caisong's Blog"><meta property="og:title" content="Rust c交互"><meta property="og:description" content='rust 调用 c 调用普通c函数 int add(int a, int b) { return a + b; } // main.rs //指定链接到C 库 #[link(name = "add")] extern { fn add(a: i32, b: i32) -> i32; } fn main() { let result = unsafe { add(1, 2) }; println!("1 + 2 = {}", result); } # 编译C库 $ gcc -c -fPIC add.c -o add.o $ gcc add.o -shared -o libadd.so # rust 链接 $ rustc main.rs -L /path/to/library/folder -l add $ ./main 1 + 2 = 3 调用C结构体 #include <stdio.h> typedef struct { int x; int y; } Point; void print_point(Point* p) { printf("Point: (%d, %d)\n", p->x, p->y); } // main.rs #[repr(C)] struct Point { x: i32, y: i32, } #[link(name = "mylib")] extern { fn print_point(p: *const Point); } fn main() { let p = Point { x: 10, y: 20 }; // 转换 Point 结构体为 C 的结构体指针类型 let c_p = &amp;p as *const Point; // 调用 C 函数 unsafe { print_point(c_p); } } 调用C内存分配 // main.rs use libc::{malloc, free}; use std::ffi::CString; #[link(name = "mylib")] extern { fn process_string(s: *const u8); } fn main() { let s = CString::new("Hello, world!").unwrap(); // 计算字符串的长度（包括终止符） let len = s.as_bytes().len() + 1; // 在 C 中分配足够的空间来保存字符串 let c_str = unsafe { malloc(len) as *mut u8 }; // 把 Rust 字符串复制到 C 字符串中 unsafe { std::ptr::copy_nonoverlapping(s.as_ptr(), c_str, len); } // 调用 C 函数并传递指向 C 字符串的指针 unsafe { process_string(c_str); } // 释放由 C 分配的内存 unsafe { free(c_str as *mut libc::c_void); } } 调用C自定义内存分配函数 // main.rs use std::os::raw::c_void; use std::alloc::{Layout, alloc, dealloc}; extern "C" { fn my_malloc(size: usize) -> *mut c_void; fn my_free(ptr: *mut c_void); } fn main() { let size = 1024; // 在 Rust 中分配内存 let layout = Layout::from_size_align(size, 1).unwrap(); let ptr = unsafe { my_malloc(size) as *mut u8 }; // 使用 Rust 操作分配的内存 for i in 0..size { unsafe { *ptr.offset(i as isize) = i as u8; } } // 调用自定义的 C 函数释放内存 unsafe { my_free(ptr as *mut c_void); } } C调用rust rust代码 #[no_mangle] pub extern "C" fn add_numbers(a:i32, b:i32) -> i32 { a + b } C 使用动态库方式调用rust rustc --crate-type=cdylib my_lib.rs #include <stdio.h> #include <stdint.h> #include <stdlib.h> #include <dlfcn.h> typedef void (*add_fn)(int32_t, int32_t, int32_t*); int main() { void* handle = dlopen("./libmylib.so", RTLD_LAZY | RTLD_GLOBAL); if (!handle) { printf("Failed to open library: %s\n", dlerror()); return -1; } add_fn add = (add_fn)dlsym(handle, "add"); if (!add) { printf("Failed to find symbol: %s\n", dlerror()); dlclose(handle); return -1; } int32_t a = 1; int32_t b = 2; int32_t result; int32_t *result_ptr = &amp;result; add(a, b, result_ptr); printf("%d + %d = %d\n", a, b, result); dlclose(handle); return 0; } C 使用静态库方式调用rust rustc --crate-type=staticlib my_lib.rs #include <stdio.h> #include <stdint.h> extern int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; } C 直接调用rust代码 #include <stdio.h> #include <stdint.h> int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; }'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-18T21:41:30+08:00"><meta property="article:modified_time" content="2023-04-18T21:41:30+08:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="C"><meta property="og:image" content="https://caisong.github.io/img/background.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://caisong.github.io/img/background.jpg"><meta name=twitter:title content="Rust c交互"><meta name=twitter:description content='rust 调用 c 调用普通c函数 int add(int a, int b) { return a + b; } // main.rs //指定链接到C 库 #[link(name = "add")] extern { fn add(a: i32, b: i32) -> i32; } fn main() { let result = unsafe { add(1, 2) }; println!("1 + 2 = {}", result); } # 编译C库 $ gcc -c -fPIC add.c -o add.o $ gcc add.o -shared -o libadd.so # rust 链接 $ rustc main.rs -L /path/to/library/folder -l add $ ./main 1 + 2 = 3 调用C结构体 #include <stdio.h> typedef struct { int x; int y; } Point; void print_point(Point* p) { printf("Point: (%d, %d)\n", p->x, p->y); } // main.rs #[repr(C)] struct Point { x: i32, y: i32, } #[link(name = "mylib")] extern { fn print_point(p: *const Point); } fn main() { let p = Point { x: 10, y: 20 }; // 转换 Point 结构体为 C 的结构体指针类型 let c_p = &amp;p as *const Point; // 调用 C 函数 unsafe { print_point(c_p); } } 调用C内存分配 // main.rs use libc::{malloc, free}; use std::ffi::CString; #[link(name = "mylib")] extern { fn process_string(s: *const u8); } fn main() { let s = CString::new("Hello, world!").unwrap(); // 计算字符串的长度（包括终止符） let len = s.as_bytes().len() + 1; // 在 C 中分配足够的空间来保存字符串 let c_str = unsafe { malloc(len) as *mut u8 }; // 把 Rust 字符串复制到 C 字符串中 unsafe { std::ptr::copy_nonoverlapping(s.as_ptr(), c_str, len); } // 调用 C 函数并传递指向 C 字符串的指针 unsafe { process_string(c_str); } // 释放由 C 分配的内存 unsafe { free(c_str as *mut libc::c_void); } } 调用C自定义内存分配函数 // main.rs use std::os::raw::c_void; use std::alloc::{Layout, alloc, dealloc}; extern "C" { fn my_malloc(size: usize) -> *mut c_void; fn my_free(ptr: *mut c_void); } fn main() { let size = 1024; // 在 Rust 中分配内存 let layout = Layout::from_size_align(size, 1).unwrap(); let ptr = unsafe { my_malloc(size) as *mut u8 }; // 使用 Rust 操作分配的内存 for i in 0..size { unsafe { *ptr.offset(i as isize) = i as u8; } } // 调用自定义的 C 函数释放内存 unsafe { my_free(ptr as *mut c_void); } } C调用rust rust代码 #[no_mangle] pub extern "C" fn add_numbers(a:i32, b:i32) -> i32 { a + b } C 使用动态库方式调用rust rustc --crate-type=cdylib my_lib.rs #include <stdio.h> #include <stdint.h> #include <stdlib.h> #include <dlfcn.h> typedef void (*add_fn)(int32_t, int32_t, int32_t*); int main() { void* handle = dlopen("./libmylib.so", RTLD_LAZY | RTLD_GLOBAL); if (!handle) { printf("Failed to open library: %s\n", dlerror()); return -1; } add_fn add = (add_fn)dlsym(handle, "add"); if (!add) { printf("Failed to find symbol: %s\n", dlerror()); dlclose(handle); return -1; } int32_t a = 1; int32_t b = 2; int32_t result; int32_t *result_ptr = &amp;result; add(a, b, result_ptr); printf("%d + %d = %d\n", a, b, result); dlclose(handle); return 0; } C 使用静态库方式调用rust rustc --crate-type=staticlib my_lib.rs #include <stdio.h> #include <stdint.h> extern int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; } C 直接调用rust代码 #include <stdio.h> #include <stdint.h> int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; }'><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between max-w-[65ch] mx-auto px-4 md:px-0"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="Flip it!"><div class="h-10 rounded-full"><img src=/img/avatar.png alt="A blog about all things technical."></div></div><div><a href=https://caisong.github.io/ class="text-lg font-semibold cursor-pointer">A blog about all things technical.</a></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=About><ion-icon name=information-circle></ion-icon>About</div></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title="All Categories"><ion-icon name=grid></ion-icon>All Categories</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=About>About</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/index.xml title=RSS><ion-icon class=group-hover:text-primary-content name=logo-rss></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title="All Categories"><ion-icon name=grid></ion-icon>All Categories</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="Rust c交互"><meta itemprop=description content='rust 调用 c 调用普通c函数 int add(int a, int b) { return a + b; } // main.rs //指定链接到C 库 #[link(name = "add")] extern { fn add(a: i32, b: i32) -> i32; } fn main() { let result = unsafe { add(1, 2) }; println!("1 + 2 = {}", result); } # 编译C库 $ gcc -c -fPIC add.c -o add.o $ gcc add.o -shared -o libadd.so # rust 链接 $ rustc main.rs -L /path/to/library/folder -l add $ ./main 1 + 2 = 3 调用C结构体 #include <stdio.h> typedef struct { int x; int y; } Point; void print_point(Point* p) { printf("Point: (%d, %d)\n", p->x, p->y); } // main.rs #[repr(C)] struct Point { x: i32, y: i32, } #[link(name = "mylib")] extern { fn print_point(p: *const Point); } fn main() { let p = Point { x: 10, y: 20 }; // 转换 Point 结构体为 C 的结构体指针类型 let c_p = &amp;p as *const Point; // 调用 C 函数 unsafe { print_point(c_p); } } 调用C内存分配 // main.rs use libc::{malloc, free}; use std::ffi::CString; #[link(name = "mylib")] extern { fn process_string(s: *const u8); } fn main() { let s = CString::new("Hello, world!").unwrap(); // 计算字符串的长度（包括终止符） let len = s.as_bytes().len() + 1; // 在 C 中分配足够的空间来保存字符串 let c_str = unsafe { malloc(len) as *mut u8 }; // 把 Rust 字符串复制到 C 字符串中 unsafe { std::ptr::copy_nonoverlapping(s.as_ptr(), c_str, len); } // 调用 C 函数并传递指向 C 字符串的指针 unsafe { process_string(c_str); } // 释放由 C 分配的内存 unsafe { free(c_str as *mut libc::c_void); } } 调用C自定义内存分配函数 // main.rs use std::os::raw::c_void; use std::alloc::{Layout, alloc, dealloc}; extern "C" { fn my_malloc(size: usize) -> *mut c_void; fn my_free(ptr: *mut c_void); } fn main() { let size = 1024; // 在 Rust 中分配内存 let layout = Layout::from_size_align(size, 1).unwrap(); let ptr = unsafe { my_malloc(size) as *mut u8 }; // 使用 Rust 操作分配的内存 for i in 0..size { unsafe { *ptr.offset(i as isize) = i as u8; } } // 调用自定义的 C 函数释放内存 unsafe { my_free(ptr as *mut c_void); } } C调用rust rust代码 #[no_mangle] pub extern "C" fn add_numbers(a:i32, b:i32) -> i32 { a + b } C 使用动态库方式调用rust rustc --crate-type=cdylib my_lib.rs #include <stdio.h> #include <stdint.h> #include <stdlib.h> #include <dlfcn.h> typedef void (*add_fn)(int32_t, int32_t, int32_t*); int main() { void* handle = dlopen("./libmylib.so", RTLD_LAZY | RTLD_GLOBAL); if (!handle) { printf("Failed to open library: %s\n", dlerror()); return -1; } add_fn add = (add_fn)dlsym(handle, "add"); if (!add) { printf("Failed to find symbol: %s\n", dlerror()); dlclose(handle); return -1; } int32_t a = 1; int32_t b = 2; int32_t result; int32_t *result_ptr = &amp;result; add(a, b, result_ptr); printf("%d + %d = %d\n", a, b, result); dlclose(handle); return 0; } C 使用静态库方式调用rust rustc --crate-type=staticlib my_lib.rs #include <stdio.h> #include <stdint.h> extern int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; } C 直接调用rust代码 #include <stdio.h> #include <stdint.h> int32_t add(int32_t, int32_t); int main() { int32_t a = 1; int32_t b = 2; int32_t result = add(a, b); printf("%d + %d = %d\n", a, b, result); return 0; }'><meta itemprop=datePublished content="2023-04-18T21:41:30+08:00"><meta itemprop=dateModified content="2023-04-18T21:41:30+08:00"><meta itemprop=wordCount content="502"><meta itemprop=image content="https://caisong.github.io/img/background.jpg"><meta itemprop=keywords content="Rust,C"><header><h1 itemprop=headline>Rust c交互</h1><p class=text-sm>Tuesday, Apr 18, 2023
| <span>3 minute read</span>
| <span>Updated at
Tuesday, Apr 18, 2023</span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>Cai Song</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=Rust%20c%e4%ba%a4%e4%ba%92&amp;url=https://caisong.github.io/posts/rustc%E4%BA%A4%E4%BA%92/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://caisong.github.io/posts/rustc%E4%BA%A4%E4%BA%92/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=Rust%20c%e4%ba%a4%e4%ba%92%20https://caisong.github.io/posts/rustc%E4%BA%A4%E4%BA%92/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><section id=dream-single-post-content itemprop=articleBody><img src=/img/cover.jpg alt="Rust c交互"><h2 id=rust-调用-c>rust 调用 c</h2><ul><li>调用普通<code>c</code>函数</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int</span> a, <span style=color:#66d9ef>int</span> b) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> a <span style=color:#f92672>+</span> b;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#75715e>//指定链接到C 库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#[link(name = </span><span style=color:#e6db74>&#34;add&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>add</span>(a: <span style=color:#66d9ef>i32</span>, b: <span style=color:#66d9ef>i32</span>) -&gt; <span style=color:#66d9ef>i32</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> <span style=color:#66d9ef>unsafe</span> { add(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>) };
</span></span><span style=display:flex><span>    println!(<span style=color:#e6db74>&#34;1 + 2 = </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, result);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 编译C库</span>
</span></span><span style=display:flex><span>$ gcc -c -fPIC add.c -o add.o
</span></span><span style=display:flex><span>$ gcc add.o -shared -o libadd.so
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># rust 链接</span>
</span></span><span style=display:flex><span>$ rustc main.rs -L /path/to/library/folder -l add
</span></span><span style=display:flex><span>$ ./main
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> + 2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><ul><li>调用C结构体</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> x;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> y;
</span></span><span style=display:flex><span>} Point;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>print_point</span>(Point<span style=color:#f92672>*</span> p) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Point: (%d, %d)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, p<span style=color:#f92672>-&gt;</span>x, p<span style=color:#f92672>-&gt;</span>y);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[repr(C)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Point</span> {
</span></span><span style=display:flex><span>    x: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>    y: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[link(name = </span><span style=color:#e6db74>&#34;mylib&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>print_point</span>(p: <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> Point);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> p <span style=color:#f92672>=</span> Point { x: <span style=color:#ae81ff>10</span>, y: <span style=color:#ae81ff>20</span> };
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 转换 Point 结构体为 C 的结构体指针类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> c_p <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>p <span style=color:#66d9ef>as</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> Point;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 调用 C 函数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>        print_point(c_p);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>调用C内存分配</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> libc::{malloc, free};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::ffi::CString;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[link(name = </span><span style=color:#e6db74>&#34;mylib&#34;</span><span style=color:#75715e>)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>process_string</span>(s: <span style=color:#f92672>*</span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>u8</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> s <span style=color:#f92672>=</span> CString::new(<span style=color:#e6db74>&#34;Hello, world!&#34;</span>).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 计算字符串的长度（包括终止符）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> len <span style=color:#f92672>=</span> s.as_bytes().len() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在 C 中分配足够的空间来保存字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> c_str <span style=color:#f92672>=</span> <span style=color:#66d9ef>unsafe</span> { malloc(len) <span style=color:#66d9ef>as</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> <span style=color:#66d9ef>u8</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 把 Rust 字符串复制到 C 字符串中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>        std::ptr::copy_nonoverlapping(s.as_ptr(), c_str, len);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 调用 C 函数并传递指向 C 字符串的指针
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>        process_string(c_str);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 释放由 C 分配的内存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>        free(c_str <span style=color:#66d9ef>as</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> libc::c_void);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>调用C自定义内存分配函数</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::os::raw::c_void;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::alloc::{Layout, alloc, dealloc};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>my_malloc</span>(size: <span style=color:#66d9ef>usize</span>) -&gt; <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> c_void;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>my_free</span>(ptr: <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> c_void);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1024</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在 Rust 中分配内存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> layout <span style=color:#f92672>=</span> Layout::from_size_align(size, <span style=color:#ae81ff>1</span>).unwrap();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> ptr <span style=color:#f92672>=</span> <span style=color:#66d9ef>unsafe</span> { my_malloc(size) <span style=color:#66d9ef>as</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> <span style=color:#66d9ef>u8</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 Rust 操作分配的内存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>size {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>*</span>ptr.offset(i <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>) <span style=color:#f92672>=</span> i <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>u8</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 调用自定义的 C 函数释放内存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unsafe</span> {
</span></span><span style=display:flex><span>        my_free(ptr <span style=color:#66d9ef>as</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>mut</span> c_void);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=c调用rust>C调用rust</h2><ul><li><code>rust</code>代码</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[no_mangle]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>add_numbers</span>(a:<span style=color:#66d9ef>i32</span>, b:<span style=color:#66d9ef>i32</span>) -&gt; <span style=color:#66d9ef>i32</span> {
</span></span><span style=display:flex><span>    a <span style=color:#f92672>+</span> b
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>C 使用动态库方式调用rust</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rustc --crate-type<span style=color:#f92672>=</span>cdylib my_lib.rs
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;dlfcn.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#a6e22e>void</span> (<span style=color:#f92672>*</span>add_fn)(<span style=color:#66d9ef>int32_t</span>, <span style=color:#66d9ef>int32_t</span>, <span style=color:#66d9ef>int32_t</span><span style=color:#f92672>*</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span><span style=color:#f92672>*</span> handle <span style=color:#f92672>=</span> <span style=color:#a6e22e>dlopen</span>(<span style=color:#e6db74>&#34;./libmylib.so&#34;</span>, RTLD_LAZY <span style=color:#f92672>|</span> RTLD_GLOBAL);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>handle) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Failed to open library: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>dlerror</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    add_fn add <span style=color:#f92672>=</span> (add_fn)<span style=color:#a6e22e>dlsym</span>(handle, <span style=color:#e6db74>&#34;add&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>add) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Failed to find symbol: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>dlerror</span>());
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>dlclose</span>(handle);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> result;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> <span style=color:#f92672>*</span>result_ptr <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>result;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span>(a, b, result_ptr);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%d + %d = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, a, b, result);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dlclose</span>(handle);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>C 使用静态库方式调用rust</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rustc --crate-type<span style=color:#f92672>=</span>staticlib my_lib.rs
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>int32_t</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int32_t</span>, <span style=color:#66d9ef>int32_t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> result <span style=color:#f92672>=</span> <span style=color:#a6e22e>add</span>(a, b);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%d + %d = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, a, b, result);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>C 直接调用rust代码</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int32_t</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int32_t</span>, <span style=color:#66d9ef>int32_t</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int32_t</span> result <span style=color:#f92672>=</span> <span style=color:#a6e22e>add</span>(a, b);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%d + %d = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, a, b, result);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><a class="group btn btn-outline" href=/posts/%E8%BF%90%E7%BB%B4%E6%8E%A5%E5%8F%A3/ title=运维接口><ion-icon name=chevron-back></ion-icon><div class="inline-flex flex-col items-start"><span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Previous page</span>
<span class="max-w-48 truncate">运维接口</span></div></a><a class="group btn btn-outline" href=/posts/git%E5%9C%B0%E5%9D%80%E6%9B%BF%E6%8D%A2/ title=Git地址替换><div class="inline-flex flex-col items-end"><span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Next page</span>
<span class="max-w-48 truncate">Git地址替换</span></div><ion-icon name=chevron-forward></ion-icon></a></div></article></div><div class="hidden lg:flex lg:flex-col lg:items-end"><nav id=TableOfContents><ul><li><a href=#rust-调用-c>rust 调用 c</a></li><li><a href=#c调用rust>C调用rust</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12"><div><p>© 2016 - 2025 Caisong's Blog</p><p class=text-sm>🌱
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="max-w-[65ch] mt-8 mx-auto px-4"><div><div class="mb-4 text-lg font-medium">About Me</div><div class="prose dark:prose-invert"><p>大龄程序员，喜欢折腾各种环境部署、软件应用。</p><p>博客记录日常。</p></div></div><div class="divider divider-vertical"></div></div><footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12"><div><p>© 2016 - 2025 Caisong's Blog</p><p class=text-sm>🌱
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=/js/main.min.js></script><script type=module>
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img')
    </script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script></body></html>