<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rsyslog on Caisong's Blog</title><link>https://caisong.github.io/categories/rsyslog/</link><description>Recent content in Rsyslog on Caisong's Blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Thu, 26 Dec 2024 21:41:28 +0800</lastBuildDate><atom:link href="https://caisong.github.io/categories/rsyslog/index.xml" rel="self" type="application/rss+xml"/><item><title>rsyslog rfc3164</title><link>https://caisong.github.io/posts/rsyslogrfc3164/</link><pubDate>Thu, 26 Dec 2024 21:41:28 +0800</pubDate><guid>https://caisong.github.io/posts/rsyslogrfc3164/</guid><description>&lt;p>自定义消息格式，但是mmnormalize模块解析失败，只能遵循标准，在已有字段中设置我的内容。特地看了下RFC 3164和5234，记录如下。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span style="display:flex;">&lt;span># RFC 3164
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;PRI&amp;gt;&amp;lt;HEADER&amp;gt; &amp;lt;MSG&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PRI和HEADER之间无空格
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>PRI = &amp;#34;&amp;lt;&amp;#34;Priority&amp;#34;&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Priority = (Facility&amp;lt;&amp;lt;3)+Severity
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Facility = 0~23
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Serverity = 0~7
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HEADER = &amp;lt;TIMESTAMP&amp;gt; &amp;lt;HOSTNAME&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TIMESTAMP = Mmm dd hh:mm:ss 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Mmm 代表月份，与dd之间有2个空格
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>时间使用24小时制
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HOSTNAME 就是正常的hostname，不能有空格，或者使用IPv4 IPv6地址。
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>MSG = &amp;lt;TAG&amp;gt;&amp;lt;CONTENT&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TAG就是程序名，不超过32字节，tag中的非字母符号就代表结束。因此CONTENT开头经常使用“[“、“：”或者空格表示内容的开始。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Rsyslog mmnormalize module</title><link>https://caisong.github.io/posts/rsyslogmmnormalizemodule/</link><pubDate>Tue, 24 Dec 2024 21:41:27 +0800</pubDate><guid>https://caisong.github.io/posts/rsyslogmmnormalizemodule/</guid><description>&lt;p>rsyslog mmnormalize module语法稀奇古怪，相关资料还特别少，看了好几遍才明白。&lt;/p>
&lt;p>最终能解析出来了，但是没法没使用，不在默认namespace &lt;code>$!&lt;/code>下，放弃了。&lt;/p>
&lt;h2 id="相关语法">相关语法&lt;/h2>
&lt;h3 id="规则语法">规则语法&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-config" data-lang="config">rule=[&amp;lt;tag1&amp;gt;[,&amp;lt;tag2&amp;gt;...]]:&amp;lt;match description&amp;gt;
# match descirption 可以出现N次
match description=&amp;lt;string literals&amp;gt;&amp;lt;field selectors&amp;gt;
# extra data是根据field type类型决定的
fileld selectors=%&amp;lt;field name&amp;gt;:&amp;lt;field type&amp;gt;[:&amp;lt;extra data&amp;gt;]%
&lt;/code>&lt;/pre>&lt;h3 id="field-type">field type&lt;/h3>
&lt;p>mmnormalize版本2的语法没有使用正则，内置了一套字段类型，与正则差不多。&lt;/p>
&lt;ul>
&lt;li>number: 数字
%field_name:number% === [0-9]+&lt;/li>
&lt;li>word: 到空格或者行末截止
%field_name:word% === \S+&lt;/li>
&lt;li>alpha: up to the next whitespace, punctuation, decimal digit or ctrl
%field_name:alpha% === \w+&lt;/li>
&lt;li>char-to: 表示直到某个字符
%field_name:char-to:,% === [^,]+&lt;/li>
&lt;li>char-sp: 表示直到某个字符，可以空。
%field_name:char-sep:,% === [^,]*&lt;/li>
&lt;li>rest：一直匹配到行结束&lt;/li>
&lt;li>quoted-string: 匹配双引号中的内容&lt;/li>
&lt;li>date-iso ： YYYY-MM-DD格式日期&lt;/li>
&lt;li>time-24hr： HH:MM:SS 24小时制时间&lt;/li>
&lt;li>time-12hr： HH:MM:SS 12小时制时间&lt;/li>
&lt;li>ipv4: 点分制ipv4地址&lt;/li>
&lt;li>date-rfc3164： Oct 29 09:47:08 格式日期&lt;/li>
&lt;li>date-rfc5424：1985-04-12T19:20:50.52-04:00 格式日期&lt;/li>
&lt;li>iptables：匹配Name=value，空格分隔的kv对
%-:iptables% 不使用字段名，匹配内容中的name替代字段名&lt;/li>
&lt;/ul>
&lt;h3 id="前置规则">前置规则&lt;/h3>
&lt;pre tabindex="0">&lt;code class="language-config" data-lang="config"># 设置前缀，可复用
prefix=&amp;lt;match description&amp;gt;
# 取消前缀
prefix=
&lt;/code>&lt;/pre>&lt;h3 id="引用">引用&lt;/h3>
&lt;p>mmnormalize匹配的内容都在&lt;code>$!&lt;/code>命名空间内，可通过&lt;code>$!field_name&lt;/code>引用&lt;/p></description></item></channel></rss>